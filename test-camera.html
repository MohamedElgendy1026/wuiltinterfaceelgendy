<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>قارئ الباركود - عرض المنتج</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html5-qrcode/2.3.8/html5-qrcode.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        /* أنماط CSS تبقى كما هي */
        /* ... */
    </style>
</head>
<body>
    <div class="container">
        <!-- HTML تبقى كما هي -->
        <!-- ... -->
    </div>

    <script>
        // المتغيرات العامة تبقى كما هي
        // ...
        
        // عرض نتيجة البحث - النسخة المعدلة
        async function showResult(barcode) {
            try {
                setStatus('loading', '🔍 جاري البحث عن المنتج في elgendypro.com...');
                
                // البحث في صفحة المنتجات
                const response = await fetch(`https://elgendypro.com/ar/product/all/`);
                
                // تحويل الاستجابة إلى نص HTML
                const html = await response.text();
                
                // تحليل HTML لاستخراج بيانات المنتج
                const parser = new DOMParser();
                const doc = parser.parseFromString(html, 'text/html');
                
                // البحث عن المنتج باستخدام رقم الباركود
                let productFound = null;
                const productElements = doc.querySelectorAll('.product-item'); // افترضنا أن كل منتج له class 'product-item'
                
                productElements.forEach(product => {
                    const productBarcode = product.querySelector('.product-barcode')?.textContent.trim();
                    if (productBarcode === barcode) {
                        productFound = product;
                    }
                });
                
                if (productFound) {
                    // استخراج بيانات المنتج
                    const name = productFound.querySelector('.product-title')?.textContent.trim() || 'غير معروف';
                    const price = productFound.querySelector('.price')?.textContent.trim() || 'غير متوفر';
                    const image = productFound.querySelector('img')?.src || 'https://via.placeholder.com/150?text=No+Image';
                    const link = productFound.querySelector('a')?.href || '#';
                    
                    resultContent.innerHTML = `
                        <img src="${image}" alt="${name}" class="product-image">
                        <h3 class="product-title">${name}</h3>
                        <p class="product-price">السعر: ${price}</p>
                        <a href="${link}" target="_blank" class="view-product-btn">عرض المنتج على elgendypro.com</a>
                    `;
                    
                    setStatus('ready', '✅ تم العثور على المنتج');
                } else {
                    resultContent.innerHTML = `
                        <div class="alert alert-warning">
                            <p>❗ لم يتم العثور على منتج مطابق للباركود: <strong>${barcode}</strong></p>
                            <p>يمكنك البحث يدوياً على <a href="https://elgendypro.com/ar/product/all/" target="_blank">elgendypro.com</a></p>
                        </div>
                    `;
                    setStatus('error', '❌ المنتج غير موجود');
                }
                
                resultEl.style.display = 'block';
                manualInput.value = barcode;
                lastResult = barcode;
                
            } catch (error) {
                console.error('خطأ في عرض النتيجة:', error);
                resultContent.innerHTML = `
                    <div class="alert alert-warning">
                        <p>❗ حدث خطأ أثناء البحث عن المنتج</p>
                        <p>${error.message || 'الرجاء المحاولة مرة أخرى'}</p>
                        <p>يمكنك البحث يدوياً على <a href="https://elgendypro.com/ar/product/all/" target="_blank">elgendypro.com</a></p>
                    </div>
                `;
                resultEl.style.display = 'block';
                setStatus('error', '❌ ' + (error.message || 'حدث خطأ أثناء البحث'));
            }
        }
        
        // بقية الدوال تبقى كما هي
        // ...
    </script>
</body>
</html>
